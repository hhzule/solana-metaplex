{"version":3,"file":"array.mjs","sources":["../../src/array.ts"],"sourcesContent":["import {\n  BaseSerializerOptions,\n  ExpectedFixedSizeSerializerError,\n  Serializer,\n  mergeBytes,\n} from '@metaplex-foundation/umi-serializers-core';\nimport { u32 } from '@metaplex-foundation/umi-serializers-numbers';\nimport { ArrayLikeSerializerSize } from './arrayLikeSerializerSize';\nimport { InvalidNumberOfItemsError } from './errors';\nimport {\n  getResolvedSize,\n  getSizeDescription,\n  getSizeFromChildren,\n  getSizePrefix,\n} from './utils';\n\n/**\n * Defines the options for array serializers.\n * @category Serializers\n */\nexport type ArraySerializerOptions = BaseSerializerOptions & {\n  /**\n   * The size of the array.\n   * @defaultValue `u32()`\n   */\n  size?: ArrayLikeSerializerSize;\n};\n\n/**\n * Creates a serializer for an array of items.\n *\n * @param item - The serializer to use for the array's items.\n * @param options - A set of options for the serializer.\n * @category Serializers\n */\nexport function array<T, U extends T = T>(\n  item: Serializer<T, U>,\n  options: ArraySerializerOptions = {}\n): Serializer<T[], U[]> {\n  const size = options.size ?? u32();\n  if (size === 'remainder' && item.fixedSize === null) {\n    throw new ExpectedFixedSizeSerializerError(\n      'Serializers of \"remainder\" size must have fixed-size items.'\n    );\n  }\n  return {\n    description:\n      options.description ??\n      `array(${item.description}; ${getSizeDescription(size)})`,\n    fixedSize: getSizeFromChildren(size, [item.fixedSize]),\n    maxSize: getSizeFromChildren(size, [item.maxSize]),\n    serialize: (value: T[]) => {\n      if (typeof size === 'number' && value.length !== size) {\n        throw new InvalidNumberOfItemsError('array', size, value.length);\n      }\n      return mergeBytes([\n        getSizePrefix(size, value.length),\n        ...value.map((v) => item.serialize(v)),\n      ]);\n    },\n    deserialize: (bytes: Uint8Array, offset = 0) => {\n      if (typeof size === 'object' && bytes.slice(offset).length === 0) {\n        return [[], offset];\n      }\n      const [resolvedSize, newOffset] = getResolvedSize(\n        size,\n        [item.fixedSize],\n        bytes,\n        offset\n      );\n      offset = newOffset;\n      const values: U[] = [];\n      for (let i = 0; i < resolvedSize; i += 1) {\n        const [value, newOffset] = item.deserialize(bytes, offset);\n        values.push(value);\n        offset = newOffset;\n      }\n      return [values, offset];\n    },\n  };\n}\n"],"names":["array","item","options","size","u32","fixedSize","ExpectedFixedSizeSerializerError","description","getSizeDescription","getSizeFromChildren","maxSize","serialize","value","length","InvalidNumberOfItemsError","mergeBytes","getSizePrefix","map","v","deserialize","bytes","offset","slice","resolvedSize","newOffset","getResolvedSize","values","i","push"],"mappings":";;;;;AAgBA;AACA;AACA;AACA;;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASA,KAAK,CACnBC,IAAsB,EACtBC,OAA+B,GAAG,EAAE,EACd;AACtB,EAAA,MAAMC,IAAI,GAAGD,OAAO,CAACC,IAAI,IAAIC,GAAG,EAAE,CAAA;EAClC,IAAID,IAAI,KAAK,WAAW,IAAIF,IAAI,CAACI,SAAS,KAAK,IAAI,EAAE;AACnD,IAAA,MAAM,IAAIC,gCAAgC,CACxC,6DAA6D,CAC9D,CAAA;AACH,GAAA;EACA,OAAO;AACLC,IAAAA,WAAW,EACTL,OAAO,CAACK,WAAW,IAClB,CAAQN,MAAAA,EAAAA,IAAI,CAACM,WAAY,CAAIC,EAAAA,EAAAA,kBAAkB,CAACL,IAAI,CAAE,CAAE,CAAA,CAAA;IAC3DE,SAAS,EAAEI,mBAAmB,CAACN,IAAI,EAAE,CAACF,IAAI,CAACI,SAAS,CAAC,CAAC;IACtDK,OAAO,EAAED,mBAAmB,CAACN,IAAI,EAAE,CAACF,IAAI,CAACS,OAAO,CAAC,CAAC;IAClDC,SAAS,EAAGC,KAAU,IAAK;MACzB,IAAI,OAAOT,IAAI,KAAK,QAAQ,IAAIS,KAAK,CAACC,MAAM,KAAKV,IAAI,EAAE;QACrD,MAAM,IAAIW,yBAAyB,CAAC,OAAO,EAAEX,IAAI,EAAES,KAAK,CAACC,MAAM,CAAC,CAAA;AAClE,OAAA;MACA,OAAOE,UAAU,CAAC,CAChBC,aAAa,CAACb,IAAI,EAAES,KAAK,CAACC,MAAM,CAAC,EACjC,GAAGD,KAAK,CAACK,GAAG,CAAEC,CAAC,IAAKjB,IAAI,CAACU,SAAS,CAACO,CAAC,CAAC,CAAC,CACvC,CAAC,CAAA;KACH;AACDC,IAAAA,WAAW,EAAE,CAACC,KAAiB,EAAEC,MAAM,GAAG,CAAC,KAAK;AAC9C,MAAA,IAAI,OAAOlB,IAAI,KAAK,QAAQ,IAAIiB,KAAK,CAACE,KAAK,CAACD,MAAM,CAAC,CAACR,MAAM,KAAK,CAAC,EAAE;AAChE,QAAA,OAAO,CAAC,EAAE,EAAEQ,MAAM,CAAC,CAAA;AACrB,OAAA;AACA,MAAA,MAAM,CAACE,YAAY,EAAEC,SAAS,CAAC,GAAGC,eAAe,CAC/CtB,IAAI,EACJ,CAACF,IAAI,CAACI,SAAS,CAAC,EAChBe,KAAK,EACLC,MAAM,CACP,CAAA;AACDA,MAAAA,MAAM,GAAGG,SAAS,CAAA;MAClB,MAAME,MAAW,GAAG,EAAE,CAAA;AACtB,MAAA,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGJ,YAAY,EAAEI,CAAC,IAAI,CAAC,EAAE;AACxC,QAAA,MAAM,CAACf,KAAK,EAAEY,SAAS,CAAC,GAAGvB,IAAI,CAACkB,WAAW,CAACC,KAAK,EAAEC,MAAM,CAAC,CAAA;AAC1DK,QAAAA,MAAM,CAACE,IAAI,CAAChB,KAAK,CAAC,CAAA;AAClBS,QAAAA,MAAM,GAAGG,SAAS,CAAA;AACpB,OAAA;AACA,MAAA,OAAO,CAACE,MAAM,EAAEL,MAAM,CAAC,CAAA;AACzB,KAAA;GACD,CAAA;AACH;;;;"}